"use strict";

var _querystring = _interopRequireDefault(require("querystring"));
var _logger = _interopRequireDefault(require("./logger"));
var _followRedirects = require("follow-redirects");
var _url = require("url");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
class HTTPResponse {
  constructor(response, body) {
    let _text, _data;
    this.status = response.statusCode;
    this.headers = response.headers || {};
    this.cookies = this.headers['set-cookie'];
    if (typeof body == 'string') {
      _text = body;
    } else if (Buffer.isBuffer(body)) {
      this.buffer = body;
    } else if (typeof body == 'object') {
      _data = body;
    }
    const getText = () => {
      if (!_text && this.buffer) {
        _text = this.buffer.toString('utf-8');
      } else if (!_text && _data) {
        _text = JSON.stringify(_data);
      }
      return _text;
    };
    const getData = () => {
      if (!_data) {
        try {
          _data = JSON.parse(getText());
        } catch (e) {
          /* */
        }
      }
      return _data;
    };
    Object.defineProperty(this, 'body', {
      get: () => {
        return body;
      }
    });
    Object.defineProperty(this, 'text', {
      enumerable: true,
      get: getText
    });
    Object.defineProperty(this, 'data', {
      enumerable: true,
      get: getData
    });
  }
}
const clients = {
  'http:': _followRedirects.http,
  'https:': _followRedirects.https
};
function makeCallback(resolve, reject) {
  return function (response) {
    const chunks = [];
    response.on('data', chunk => {
      chunks.push(chunk);
    });
    response.on('end', () => {
      const body = Buffer.concat(chunks);
      const httpResponse = new HTTPResponse(response, body);

      // Consider <200 && >= 400 as errors
      if (httpResponse.status < 200 || httpResponse.status >= 400) {
        return reject(httpResponse);
      } else {
        return resolve(httpResponse);
      }
    });
    response.on('error', reject);
  };
}
const encodeBody = function ({
  body,
  headers = {}
}) {
  if (typeof body !== 'object') {
    return {
      body,
      headers
    };
  }
  var contentTypeKeys = Object.keys(headers).filter(key => {
    return key.match(/content-type/i) != null;
  });
  if (contentTypeKeys.length == 0) {
    // no content type
    //  As per https://parse.com/docs/cloudcode/guide#cloud-code-advanced-sending-a-post-request the default encoding is supposedly x-www-form-urlencoded

    body = _querystring.default.stringify(body);
    headers['Content-Type'] = 'application/x-www-form-urlencoded';
  } else {
    /* istanbul ignore next */
    if (contentTypeKeys.length > 1) {
      _logger.default.error('Parse.Cloud.httpRequest', 'multiple content-type headers are set.');
    }
    // There maybe many, we'll just take the 1st one
    var contentType = contentTypeKeys[0];
    if (headers[contentType].match(/application\/json/i)) {
      body = JSON.stringify(body);
    } else if (headers[contentType].match(/application\/x-www-form-urlencoded/i)) {
      body = _querystring.default.stringify(body);
    }
  }
  return {
    body,
    headers
  };
};
function httpRequest(options) {
  let url;
  try {
    url = (0, _url.parse)(options.url);
  } catch (e) {
    return Promise.reject(e);
  }
  options = Object.assign(options, encodeBody(options));
  // support params options
  if (typeof options.params === 'object') {
    options.qs = options.params;
  } else if (typeof options.params === 'string') {
    options.qs = _querystring.default.parse(options.params);
  }
  const client = clients[url.protocol];
  if (!client) {
    return Promise.reject(`Unsupported protocol ${url.protocol}`);
  }
  const requestOptions = {
    method: options.method,
    port: Number(url.port),
    path: url.pathname,
    hostname: url.hostname,
    headers: options.headers,
    encoding: null,
    followRedirects: options.followRedirects === true
  };
  if (requestOptions.headers) {
    Object.keys(requestOptions.headers).forEach(key => {
      if (typeof requestOptions.headers[key] === 'undefined') {
        delete requestOptions.headers[key];
      }
    });
  }
  if (url.search) {
    options.qs = Object.assign({}, options.qs, _querystring.default.parse(url.query));
  }
  if (url.auth) {
    requestOptions.auth = url.auth;
  }
  if (options.qs) {
    requestOptions.path += `?${_querystring.default.stringify(options.qs)}`;
  }
  if (options.agent) {
    requestOptions.agent = options.agent;
  }
  return new Promise((resolve, reject) => {
    const req = client.request(requestOptions, makeCallback(resolve, reject, options));
    if (options.body) {
      req.write(options.body);
    }
    req.on('error', error => {
      reject(error);
    });
    req.end();
  });
}
module.exports = httpRequest;
module.exports.encodeBody = encodeBody;
module.exports.HTTPResponse = HTTPResponse;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcXVlcnlzdHJpbmciLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9sb2dnZXIiLCJfZm9sbG93UmVkaXJlY3RzIiwiX3VybCIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiSFRUUFJlc3BvbnNlIiwiY29uc3RydWN0b3IiLCJyZXNwb25zZSIsImJvZHkiLCJfdGV4dCIsIl9kYXRhIiwic3RhdHVzIiwic3RhdHVzQ29kZSIsImhlYWRlcnMiLCJjb29raWVzIiwiQnVmZmVyIiwiaXNCdWZmZXIiLCJidWZmZXIiLCJnZXRUZXh0IiwidG9TdHJpbmciLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0RGF0YSIsInBhcnNlIiwiZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0IiwiZW51bWVyYWJsZSIsImNsaWVudHMiLCJodHRwIiwiaHR0cHMiLCJtYWtlQ2FsbGJhY2siLCJyZXNvbHZlIiwicmVqZWN0IiwiY2h1bmtzIiwib24iLCJjaHVuayIsInB1c2giLCJjb25jYXQiLCJodHRwUmVzcG9uc2UiLCJlbmNvZGVCb2R5IiwiY29udGVudFR5cGVLZXlzIiwia2V5cyIsImZpbHRlciIsImtleSIsIm1hdGNoIiwibGVuZ3RoIiwicXVlcnlzdHJpbmciLCJsb2ciLCJlcnJvciIsImNvbnRlbnRUeXBlIiwiaHR0cFJlcXVlc3QiLCJvcHRpb25zIiwidXJsIiwiUHJvbWlzZSIsImFzc2lnbiIsInBhcmFtcyIsInFzIiwiY2xpZW50IiwicHJvdG9jb2wiLCJyZXF1ZXN0T3B0aW9ucyIsIm1ldGhvZCIsInBvcnQiLCJOdW1iZXIiLCJwYXRoIiwicGF0aG5hbWUiLCJob3N0bmFtZSIsImVuY29kaW5nIiwiZm9sbG93UmVkaXJlY3RzIiwiZm9yRWFjaCIsInNlYXJjaCIsInF1ZXJ5IiwiYXV0aCIsImFnZW50IiwicmVxIiwicmVxdWVzdCIsIndyaXRlIiwiZW5kIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXF1ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBxdWVyeXN0cmluZyBmcm9tICdxdWVyeXN0cmluZyc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IGh0dHAsIGh0dHBzIH0gZnJvbSAnZm9sbG93LXJlZGlyZWN0cyc7XG5pbXBvcnQgeyBwYXJzZSB9IGZyb20gJ3VybCc7XG5cbmNsYXNzIEhUVFBSZXNwb25zZSB7XG4gIGNvbnN0cnVjdG9yKHJlc3BvbnNlLCBib2R5KSB7XG4gICAgbGV0IF90ZXh0LCBfZGF0YTtcbiAgICB0aGlzLnN0YXR1cyA9IHJlc3BvbnNlLnN0YXR1c0NvZGU7XG4gICAgdGhpcy5oZWFkZXJzID0gcmVzcG9uc2UuaGVhZGVycyB8fCB7fTtcbiAgICB0aGlzLmNvb2tpZXMgPSB0aGlzLmhlYWRlcnNbJ3NldC1jb29raWUnXTtcblxuICAgIGlmICh0eXBlb2YgYm9keSA9PSAnc3RyaW5nJykge1xuICAgICAgX3RleHQgPSBib2R5O1xuICAgIH0gZWxzZSBpZiAoQnVmZmVyLmlzQnVmZmVyKGJvZHkpKSB7XG4gICAgICB0aGlzLmJ1ZmZlciA9IGJvZHk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgYm9keSA9PSAnb2JqZWN0Jykge1xuICAgICAgX2RhdGEgPSBib2R5O1xuICAgIH1cblxuICAgIGNvbnN0IGdldFRleHQgPSAoKSA9PiB7XG4gICAgICBpZiAoIV90ZXh0ICYmIHRoaXMuYnVmZmVyKSB7XG4gICAgICAgIF90ZXh0ID0gdGhpcy5idWZmZXIudG9TdHJpbmcoJ3V0Zi04Jyk7XG4gICAgICB9IGVsc2UgaWYgKCFfdGV4dCAmJiBfZGF0YSkge1xuICAgICAgICBfdGV4dCA9IEpTT04uc3RyaW5naWZ5KF9kYXRhKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBfdGV4dDtcbiAgICB9O1xuXG4gICAgY29uc3QgZ2V0RGF0YSA9ICgpID0+IHtcbiAgICAgIGlmICghX2RhdGEpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBfZGF0YSA9IEpTT04ucGFyc2UoZ2V0VGV4dCgpKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIC8qICovXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBfZGF0YTtcbiAgICB9O1xuXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdib2R5Jywge1xuICAgICAgZ2V0OiAoKSA9PiB7XG4gICAgICAgIHJldHVybiBib2R5O1xuICAgICAgfSxcbiAgICB9KTtcblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAndGV4dCcsIHtcbiAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICBnZXQ6IGdldFRleHQsXG4gICAgfSk7XG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ2RhdGEnLCB7XG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgZ2V0OiBnZXREYXRhLFxuICAgIH0pO1xuICB9XG59XG5cbmNvbnN0IGNsaWVudHMgPSB7XG4gICdodHRwOic6IGh0dHAsXG4gICdodHRwczonOiBodHRwcyxcbn07XG5cbmZ1bmN0aW9uIG1ha2VDYWxsYmFjayhyZXNvbHZlLCByZWplY3QpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgIGNvbnN0IGNodW5rcyA9IFtdO1xuICAgIHJlc3BvbnNlLm9uKCdkYXRhJywgY2h1bmsgPT4ge1xuICAgICAgY2h1bmtzLnB1c2goY2h1bmspO1xuICAgIH0pO1xuICAgIHJlc3BvbnNlLm9uKCdlbmQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBib2R5ID0gQnVmZmVyLmNvbmNhdChjaHVua3MpO1xuICAgICAgY29uc3QgaHR0cFJlc3BvbnNlID0gbmV3IEhUVFBSZXNwb25zZShyZXNwb25zZSwgYm9keSk7XG5cbiAgICAgIC8vIENvbnNpZGVyIDwyMDAgJiYgPj0gNDAwIGFzIGVycm9yc1xuICAgICAgaWYgKGh0dHBSZXNwb25zZS5zdGF0dXMgPCAyMDAgfHwgaHR0cFJlc3BvbnNlLnN0YXR1cyA+PSA0MDApIHtcbiAgICAgICAgcmV0dXJuIHJlamVjdChodHRwUmVzcG9uc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoaHR0cFJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXNwb25zZS5vbignZXJyb3InLCByZWplY3QpO1xuICB9O1xufVxuXG5jb25zdCBlbmNvZGVCb2R5ID0gZnVuY3Rpb24gKHsgYm9keSwgaGVhZGVycyA9IHt9IH0pIHtcbiAgaWYgKHR5cGVvZiBib2R5ICE9PSAnb2JqZWN0Jykge1xuICAgIHJldHVybiB7IGJvZHksIGhlYWRlcnMgfTtcbiAgfVxuICB2YXIgY29udGVudFR5cGVLZXlzID0gT2JqZWN0LmtleXMoaGVhZGVycykuZmlsdGVyKGtleSA9PiB7XG4gICAgcmV0dXJuIGtleS5tYXRjaCgvY29udGVudC10eXBlL2kpICE9IG51bGw7XG4gIH0pO1xuXG4gIGlmIChjb250ZW50VHlwZUtleXMubGVuZ3RoID09IDApIHtcbiAgICAvLyBubyBjb250ZW50IHR5cGVcbiAgICAvLyAgQXMgcGVyIGh0dHBzOi8vcGFyc2UuY29tL2RvY3MvY2xvdWRjb2RlL2d1aWRlI2Nsb3VkLWNvZGUtYWR2YW5jZWQtc2VuZGluZy1hLXBvc3QtcmVxdWVzdCB0aGUgZGVmYXVsdCBlbmNvZGluZyBpcyBzdXBwb3NlZGx5IHgtd3d3LWZvcm0tdXJsZW5jb2RlZFxuXG4gICAgYm9keSA9IHF1ZXJ5c3RyaW5nLnN0cmluZ2lmeShib2R5KTtcbiAgICBoZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnO1xuICB9IGVsc2Uge1xuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgaWYgKGNvbnRlbnRUeXBlS2V5cy5sZW5ndGggPiAxKSB7XG4gICAgICBsb2cuZXJyb3IoJ1BhcnNlLkNsb3VkLmh0dHBSZXF1ZXN0JywgJ211bHRpcGxlIGNvbnRlbnQtdHlwZSBoZWFkZXJzIGFyZSBzZXQuJyk7XG4gICAgfVxuICAgIC8vIFRoZXJlIG1heWJlIG1hbnksIHdlJ2xsIGp1c3QgdGFrZSB0aGUgMXN0IG9uZVxuICAgIHZhciBjb250ZW50VHlwZSA9IGNvbnRlbnRUeXBlS2V5c1swXTtcbiAgICBpZiAoaGVhZGVyc1tjb250ZW50VHlwZV0ubWF0Y2goL2FwcGxpY2F0aW9uXFwvanNvbi9pKSkge1xuICAgICAgYm9keSA9IEpTT04uc3RyaW5naWZ5KGJvZHkpO1xuICAgIH0gZWxzZSBpZiAoaGVhZGVyc1tjb250ZW50VHlwZV0ubWF0Y2goL2FwcGxpY2F0aW9uXFwveC13d3ctZm9ybS11cmxlbmNvZGVkL2kpKSB7XG4gICAgICBib2R5ID0gcXVlcnlzdHJpbmcuc3RyaW5naWZ5KGJvZHkpO1xuICAgIH1cbiAgfVxuICByZXR1cm4geyBib2R5LCBoZWFkZXJzIH07XG59O1xuXG5mdW5jdGlvbiBodHRwUmVxdWVzdChvcHRpb25zKSB7XG4gIGxldCB1cmw7XG4gIHRyeSB7XG4gICAgdXJsID0gcGFyc2Uob3B0aW9ucy51cmwpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGUpO1xuICB9XG4gIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKG9wdGlvbnMsIGVuY29kZUJvZHkob3B0aW9ucykpO1xuICAvLyBzdXBwb3J0IHBhcmFtcyBvcHRpb25zXG4gIGlmICh0eXBlb2Ygb3B0aW9ucy5wYXJhbXMgPT09ICdvYmplY3QnKSB7XG4gICAgb3B0aW9ucy5xcyA9IG9wdGlvbnMucGFyYW1zO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBvcHRpb25zLnBhcmFtcyA9PT0gJ3N0cmluZycpIHtcbiAgICBvcHRpb25zLnFzID0gcXVlcnlzdHJpbmcucGFyc2Uob3B0aW9ucy5wYXJhbXMpO1xuICB9XG4gIGNvbnN0IGNsaWVudCA9IGNsaWVudHNbdXJsLnByb3RvY29sXTtcbiAgaWYgKCFjbGllbnQpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYFVuc3VwcG9ydGVkIHByb3RvY29sICR7dXJsLnByb3RvY29sfWApO1xuICB9XG4gIGNvbnN0IHJlcXVlc3RPcHRpb25zID0ge1xuICAgIG1ldGhvZDogb3B0aW9ucy5tZXRob2QsXG4gICAgcG9ydDogTnVtYmVyKHVybC5wb3J0KSxcbiAgICBwYXRoOiB1cmwucGF0aG5hbWUsXG4gICAgaG9zdG5hbWU6IHVybC5ob3N0bmFtZSxcbiAgICBoZWFkZXJzOiBvcHRpb25zLmhlYWRlcnMsXG4gICAgZW5jb2Rpbmc6IG51bGwsXG4gICAgZm9sbG93UmVkaXJlY3RzOiBvcHRpb25zLmZvbGxvd1JlZGlyZWN0cyA9PT0gdHJ1ZSxcbiAgfTtcbiAgaWYgKHJlcXVlc3RPcHRpb25zLmhlYWRlcnMpIHtcbiAgICBPYmplY3Qua2V5cyhyZXF1ZXN0T3B0aW9ucy5oZWFkZXJzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICBpZiAodHlwZW9mIHJlcXVlc3RPcHRpb25zLmhlYWRlcnNba2V5XSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgZGVsZXRlIHJlcXVlc3RPcHRpb25zLmhlYWRlcnNba2V5XTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuICBpZiAodXJsLnNlYXJjaCkge1xuICAgIG9wdGlvbnMucXMgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLnFzLCBxdWVyeXN0cmluZy5wYXJzZSh1cmwucXVlcnkpKTtcbiAgfVxuICBpZiAodXJsLmF1dGgpIHtcbiAgICByZXF1ZXN0T3B0aW9ucy5hdXRoID0gdXJsLmF1dGg7XG4gIH1cbiAgaWYgKG9wdGlvbnMucXMpIHtcbiAgICByZXF1ZXN0T3B0aW9ucy5wYXRoICs9IGA/JHtxdWVyeXN0cmluZy5zdHJpbmdpZnkob3B0aW9ucy5xcyl9YDtcbiAgfVxuICBpZiAob3B0aW9ucy5hZ2VudCkge1xuICAgIHJlcXVlc3RPcHRpb25zLmFnZW50ID0gb3B0aW9ucy5hZ2VudDtcbiAgfVxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGNvbnN0IHJlcSA9IGNsaWVudC5yZXF1ZXN0KHJlcXVlc3RPcHRpb25zLCBtYWtlQ2FsbGJhY2socmVzb2x2ZSwgcmVqZWN0LCBvcHRpb25zKSk7XG4gICAgaWYgKG9wdGlvbnMuYm9keSkge1xuICAgICAgcmVxLndyaXRlKG9wdGlvbnMuYm9keSk7XG4gICAgfVxuICAgIHJlcS5vbignZXJyb3InLCBlcnJvciA9PiB7XG4gICAgICByZWplY3QoZXJyb3IpO1xuICAgIH0pO1xuICAgIHJlcS5lbmQoKTtcbiAgfSk7XG59XG5tb2R1bGUuZXhwb3J0cyA9IGh0dHBSZXF1ZXN0O1xubW9kdWxlLmV4cG9ydHMuZW5jb2RlQm9keSA9IGVuY29kZUJvZHk7XG5tb2R1bGUuZXhwb3J0cy5IVFRQUmVzcG9uc2UgPSBIVFRQUmVzcG9uc2U7XG4iXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBQUEsWUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsT0FBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUUsZ0JBQUEsR0FBQUYsT0FBQTtBQUNBLElBQUFHLElBQUEsR0FBQUgsT0FBQTtBQUE0QixTQUFBRCx1QkFBQUssR0FBQSxXQUFBQSxHQUFBLElBQUFBLEdBQUEsQ0FBQUMsVUFBQSxHQUFBRCxHQUFBLEtBQUFFLE9BQUEsRUFBQUYsR0FBQTtBQUU1QixNQUFNRyxZQUFZLENBQUM7RUFDakJDLFdBQVdBLENBQUNDLFFBQVEsRUFBRUMsSUFBSSxFQUFFO0lBQzFCLElBQUlDLEtBQUssRUFBRUMsS0FBSztJQUNoQixJQUFJLENBQUNDLE1BQU0sR0FBR0osUUFBUSxDQUFDSyxVQUFVO0lBQ2pDLElBQUksQ0FBQ0MsT0FBTyxHQUFHTixRQUFRLENBQUNNLE9BQU8sSUFBSSxDQUFDLENBQUM7SUFDckMsSUFBSSxDQUFDQyxPQUFPLEdBQUcsSUFBSSxDQUFDRCxPQUFPLENBQUMsWUFBWSxDQUFDO0lBRXpDLElBQUksT0FBT0wsSUFBSSxJQUFJLFFBQVEsRUFBRTtNQUMzQkMsS0FBSyxHQUFH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